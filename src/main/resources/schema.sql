CREATE TABLE IF NOT EXISTS users (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  name VARCHAR(255) NOT NULL,
  email VARCHAR(512) NOT NULL,
  age BIGINT NOT NULL,
  weight BIGINT NOT NULL,
  height BIGINT NOT NULL,
  goal VARCHAR(50) NOT NULL,
  daily_calories FLOAT NOT NULL,
  CONSTRAINT pk_user PRIMARY KEY (id),
  CONSTRAINT UQ_USER_EMAIL UNIQUE (email)
);

CREATE TABLE IF NOT EXISTS dishes (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  name VARCHAR(255) NOT NULL,
  calories FLOAT NOT NULL,
  protein BIGINT,
  fat BIGINT,
  carbs BIGINT,
  CONSTRAINT pk_dish PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS meals (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  meal_time TIMESTAMP WITHOUT TIME ZONE NOT NULL,
  user_id BIGINT REFERENCES users(id) NOT NULL,
  calories BIGINT NOT NULL,
  CONSTRAINT pk_meal PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS meal_dish (
  meal_id INTEGER NOT NULL REFERENCES meals(id),
  dish_id INTEGER NOT NULL REFERENCES dishes(id),
  PRIMARY KEY (dish_id, meal_id)
);